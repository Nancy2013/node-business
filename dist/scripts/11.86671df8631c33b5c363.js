webpackJsonp([11],{1008:function(t,e,a){"use strict";var n=(a(34),a(32)),i=n.a.deviceManageAsk,r=n.a.groupManageAsk;e.a={name:"DeviceModal",components:{},mixins:[],props:{title:{type:String,default:"选择设备"},data:{type:Array,default:function(){return[]}},flag:{type:String,default:"null"},productid:{type:String,default:""}},data:function(){return{isModal:!0,deviceList:[],checkedList:[],spinning:!1,search:"",remark:"",did:"",groupid:0,groupList:[]}},computed:{indeterminate:function(){var t=this.checkedList,e=this.filterDevice;return!!t.length&&t.length<e.length},filterDevice:function(){var t=this.data,e=void 0===t?[]:t,a=this.deviceList;return a&&a.filter(function(t){return!e.includes(t.did)})||[]},checkAll:function(){var t=this.checkedList,e=this.filterDevice;return t.length===e.length&&t.length>0}},watch:{},created:function(){"timeLinkage"===this.flag&&this.getAllGroup(),this.getDevice()},mounted:function(){},destroyed:function(){},methods:{cancel:function(){this.$emit("cancel")},ok:function(){this.spinning=!0;var t=this.checkedList,e=this.deviceList;if(t.length<1)return this.$message.warning("请先选择设备！"),void(this.spinning=!1);var a=[];t.forEach(function(t){var n=e.findIndex(function(e){return e.did===t});n>-1&&a.push(e[n])}),this.$emit("ok",a)},onCheckAllChange:function(t){var e=this.filterDevice;Object.assign(this,{checkedList:t.target.checked?e&&e.map(function(t){return t.did}):[]})},doSearch:function(){this.checkedList=[],this.getDevice()},filterOption:function(t,e){return e.componentOptions.children[0].text.toLowerCase().indexOf(t.toLowerCase())>=0},getAllGroup:function(){var t=this;r.getGroup().then(function(e){var a=e.errcode,n=e.data,i=void 0===n?{}:n;200===a&&(t.groupList=i)}).catch(function(t){})},getDevice:function(){var t=this;this.spinning=!0;var e=this.search,a=this.flag,n=this.did,r=this.remark,s=this.productid,o=this.groupid,c={limit:this.GLOBAL.MAX_LEN,offset:1,displayname:e,remark:r,did:n};switch(a){case"siteid":case"groupid":c[a]=-1;break;case"taskid":c.running="-1",c[a]=-1;break;case"timeLinkage":c.productid=s,c.groupid=0===o?null:o}i.getDevice(c).then(function(e){var a=e.errcode,n=e.data,i=void 0===n?{}:n;200===a&&(t.deviceList=i.deviceInfos||[],t.spinning=!1)}).catch(function(e){t.spinning=!1})}}}},1009:function(t,e,a){"use strict";function n(t){a(1021)}var i=a(1010),r=a(1022),s=a(24),o=n,c=s(i.a,r.a,!1,o,"data-v-08f44f4e",null);e.a=c.exports},1010:function(t,e,a){"use strict";function n(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function i(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,a){function n(i,r){try{var s=e[i](r),o=s.value}catch(t){return void a(t)}if(!s.done)return Promise.resolve(o).then(function(t){n("next",t)},function(t){n("throw",t)});t(o)}return n("next")})}}var r=a(34),s=a(32),o=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var a=arguments[e];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(t[n]=a[n])}return t};s.a.deviceManageAsk;e.a={name:"StatusModal",components:{},props:{status:{type:Object,default:function(){}},productid:{type:String,required:!0}},data:function(){return{isModal:!0,labelCol:{span:4},wrapperCol:{span:20},spinning:!1,deviceStatus:o({},this.status),formartStatus:[],slider:0}},computed:o({},Object(r.mapGetters)("deviceManage",["formatAttributes"]),Object(r.mapState)("deviceManage",["valueType"]),{setStatus:function(){return function(t,e){var a=this.deviceStatus;return a&&a[t]===e?"primary":null}},getFormatStatus:function(){var t=this.deviceStatus,e=void 0===t?{}:t,a=this.formatAttributes,n=void 0===a?[]:a,i=this.valueType,r=[];return Object.keys(e).forEach(function(t){if(null!==e[t]){var a=n.filter(function(e){return e.key===t})[0]||{},s={key:t,value:""+e[t]};if(a.valuetype===i.enum||a.valuetype===i.string){var o=a.status.filter(function(a){return a.value===e[t]})[0]||{};s.text=a.text+"-"+(o.text||e[t])}a.valuetype===i.range&&(s.text=a.text+"-"+e[t]),r.push(s)}}),r}}),watch:{},created:function(){var t=this;return i(regeneratorRuntime.mark(function e(){var a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.productid,e.next=3,t.getProductAttributes({productid:a});case 3:case"end":return e.stop()}},e,t)}))()},mounted:function(){},methods:o({},Object(r.mapActions)("deviceManage",["getProductAttributes"]),{setAction:function(t,e){var a=this.deviceStatus,i=this.valueType,r=void 0;r=(t.valuetype===i.enum||t.valuetype===i.string)&&a[t.key]===e?null:e,this.deviceStatus=Object.assign({},this.deviceStatus,n({},t.key,r))},cancel:function(){this.$emit("cancel")},ok:function(){var t=this.getFormatStatus;if(t.length<=0)return void this.$message.warning("请选择要执行的操作！");this.$emit("ok",t),this.cancel()}})}},1011:function(t,e,a){"use strict";var n=a(1009),i=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var a=arguments[e];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(t[n]=a[n])}return t};e.a={name:"Actions",components:{StatusModal:n.a},mixins:[],props:{actions:{type:Object,default:function(){}}},data:function(){return{devActions:this.actions,status:{},isStatusModal:!1}},computed:{getDevicePlaceholder:function(){return""+(this.devActions.devicename||"")},getStatusPlaceholder:function(){var t=this.devActions.actions,e=void 0===t?[]:t,a=e.map(function(t){return t.attrname});return 0===e.length?"暂无设置":a.join("/")}},watch:{},created:function(){},mounted:function(){},destroyed:function(){},methods:{setAction:function(){this.isStatusModal=!0;var t=this.devActions.actions,e=void 0===t?[]:t,a={};e.forEach(function(t){a[t.attrmethod]=t.attrvalue}),this.status=a},cancelStatusModal:function(){this.isStatusModal=!1},okStatusModal:function(t){var e=t.map(function(t){return{attrmethod:t.key,attrname:t.text,attrvalue:""+t.value}}),a=i({},this.devActions,{actions:e});this.devActions=Object.assign({},this.devActions,a),this.$emit("getValue",this.devActions),this.cancelStatusModal()}}}},1013:function(t,e,a){"use strict";function n(t){a(1014)}var i=a(1008),r=a(1015),s=a(24),o=n,c=s(i.a,r.a,!1,o,"data-v-ce73d7ec",null);e.a=c.exports},1014:function(t,e){},1015:function(t,e,a){"use strict";var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("a-modal",{attrs:{"mask-closable":!1,width:560,footer:null,title:t.title},on:{cancel:t.cancel},model:{value:t.isModal,callback:function(e){t.isModal=e},expression:"isModal"}},[a("a-row",{attrs:{gutter:10}},[a("a-col",{attrs:{span:12}},["timeLinkage"===t.flag?a("a-select",{staticStyle:{width:"100%"},attrs:{"filter-option":t.filterOption,"show-search":!0},on:{change:t.doSearch},model:{value:t.groupid,callback:function(e){t.groupid=e},expression:"groupid"}},[a("a-select-option",{attrs:{value:0}},[t._v("全部设备")]),t._v(" "),t._l(t.groupList,function(e){return a("a-select-option",{key:e.id,attrs:{value:e.id}},[t._v(t._s(e.name))])})],2):a("a-input-search",{attrs:{placeholder:"请输入设备名称搜索","enter-button":""},on:{search:t.doSearch},model:{value:t.search,callback:function(e){t.search="string"==typeof e?e.trim():e},expression:"search"}})],1),t._v(" "),"siteid"===t.flag?a("a-col",{attrs:{span:12}},[a("a-input-search",{attrs:{placeholder:"请输入站点名称搜索","enter-button":""},on:{search:t.doSearch},model:{value:t.remark,callback:function(e){t.remark="string"==typeof e?e.trim():e},expression:"remark"}})],1):a("a-col",{attrs:{span:12}},[a("a-input-search",{attrs:{placeholder:"请输入设备DID搜索","enter-button":""},on:{search:t.doSearch},model:{value:t.did,callback:function(e){t.did="string"==typeof e?e.trim():e},expression:"did"}})],1)],1),t._v(" "),a("a-spin",{attrs:{spinning:t.spinning}},[a("div",{staticClass:"modal-border-panel mt20"},[a("div",[a("a-checkbox",{staticStyle:{"margin-bottom":"10px"},attrs:{checked:t.checkAll,indeterminate:t.indeterminate},on:{change:t.onCheckAllChange}},[t._v("全选")])],1),t._v(" "),a("a-checkbox-group",{model:{value:t.checkedList,callback:function(e){t.checkedList=e},expression:"checkedList"}},t._l(t.filterDevice,function(e){return a("a-row",{key:e.did,staticClass:"mb10"},[a("a-checkbox",{attrs:{value:e.did}},[t._v(t._s(e.displayname+"("+e.did+")"))])],1)}),1)],1),t._v(" "),a("div",{staticClass:"modal-footer-btn mt20"},[a("a-button",{on:{click:t.cancel}},[t._v("取消")]),t._v(" "),a("a-button",{staticClass:"ml10",attrs:{type:"primary"},on:{click:t.ok}},[t._v("确定\n        ")])],1)])],1),t._v(">\n")],1)},i=[],r={render:n,staticRenderFns:i};e.a=r},1016:function(t,e,a){"use strict";var n=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var a=arguments[e];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(t[n]=a[n])}return t},i=a(1017),r=i.keys().reduce(function(t,e){var a=e.match(/\.\/(.*)\.js$/);if(!a)return null;var n=a[1];return t[n.substr(0,1).toUpperCase()+n.substr(1)+"CreaterMix"]=i(e).default,t},{});e.a=n({},r)},1017:function(t,e,a){function n(t){return a(i(t))}function i(t){var e=r[t];if(!(e+1))throw new Error("Cannot find module '"+t+"'.");return e}var r={"./locationList.js":1018,"./pageTable.js":1019,"./timeLinkageDetail.js":1020,"./timeLinkageList.js":1026};n.keys=function(){return Object.keys(r)},n.resolve=i,t.exports=n,n.id=1017},1018:function(t,e,a){"use strict";function n(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}Object.defineProperty(e,"__esModule",{value:!0});var i=a(34),r=a(32),s=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var a=arguments[e];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(t[n]=a[n])}return t},o=r.a.locationManageAsk;e.default=function(t){return{data:function(){return{data:[],spinning:!1,current:1,total:0}},computed:s({},Object(i.mapState)("locationManage",["provincial","urban","areas","search"])),created:function(){this[t+"List"]()},methods:n({doSearch:function(){this.current=1,this[t+"List"]()},detail:function(e){this.$router.push({name:t+"Detail",params:{id:e.id}})},change:function(e){this.current=e,this[t+"List"]()}},t+"List",function e(){var a=this;this.spinning=!0;var n=this.current,i=this.GLOBAL,r=this.provincial,s=this.urban,c=this.areas,u=this.search,l={limit:i.PAGE_SIZE_S,offset:n,name:u,provincial:r,urban:s,areas:c,order:"_id",seq:-1};o[t+"List"](l).then(function(n){var i=n.errcode,r=n.data,s=r===e?{}:r;if(200===i){var o=s.totalsize,c=o===e?0:o,u=s[t+"Infos"];a.total=c,a.data=u}a.spinning=!1}).catch(function(t){a.spinning=!1})})}}},1019:function(t,e,a){"use strict";function n(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function i(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,a){function n(i,r){try{var s=e[i](r),o=s.value}catch(t){return void a(t)}if(!s.done)return Promise.resolve(o).then(function(t){n("next",t)},function(t){n("throw",t)});t(o)}return n("next")})}}Object.defineProperty(e,"__esModule",{value:!0});var r=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var a=arguments[e];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(t[n]=a[n])}return t};e.default=function(t){var e;return{data:function(){return{loading:!1,params:{},columns:[],data:[],tableFilter:{},pagination:{defaultCurrent:1,current:1,pageSize:15,total:0}}},created:function(){if("function"==typeof this[t+"Columns"]&&(this.columns=this[t+"Columns"]()),["group"].includes(t)){this.group.id&&this[t+"Fetch"]()}else this[t+"Fetch"]()},methods:(e={init:function(){this.pagination.current=1,this[t+"Fetch"]()}},n(e,t+"Fetch",function e(){var a=this;return i(regeneratorRuntime.mark(function n(){var i,s,o,c,u,l,d,f;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return i=a,i.loading=!0,s=i.pagination,o=i.tableFilter,c=r({offset:s.current,limit:s.pageSize,seq:-1},i.params||{}),Object.keys(o).map(function(t){c[t]=JSON.stringify(o[t])}),n.next=7,a[t+"FetchList"](c);case 7:u=n.sent,u&&(l=u.data,d=l===e?[]:l,f=u.total,i.data=d||[],s.total=f||0,i.loading=!1);case 9:case"end":return n.stop()}},n,a)}))()}),n(e,t+"ShowBeforeTotal",function(t,e){return"共"+t+"条，每页显示"+e+"条"}),n(e,t+"Change",function(e,a){["device","group"].includes(t)&&this.stopTime();var n=this.pagination;n.current=Math.abs(parseInt(e.current)),n.pageSize=e.pageSize,this.tableFilter=a,this[t+"Fetch"]()}),n(e,t+"FormatPagination",function(t){var e=this.data,a=this.pagination;"add"===t?e.length===a.pageSize&&(this.pagination.current=a.current+1):1===e.length&&a.current>1&&(this.pagination.current=a.current-1)}),n(e,"formatPagination",function(){var t=this.data,e=this.pagination;1===t.length&&e.current>1&&(this.pagination.current=e.current-1)}),e)}}},1020:function(t,e,a){"use strict";function n(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}Object.defineProperty(e,"__esModule",{value:!0});var i=a(34),r=a(32),s=a(1013),o=a(1009),c=a(1023),u=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var a=arguments[e];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(t[n]=a[n])}return t},l=r.a.timeLinkageAsk;e.default=function(t){return{components:{DeviceModal:s.a,StatusModal:o.a,Actions:c.a},data:function(){return{form:this.$form.createForm(this),labelCol:{span:2},wrapperCol:{span:8},id:this.$route.params.id,data:{enable:1,schedule:{isrepeat:0},effects:[],factors:[]},isDeviceModal:!1,isAction:!0,isStatusModal:!1,status:{},current:{},empty:"暂无设置",dids:[]}},computed:u({},Object(i.mapState)("timeLinkage",["repeat","typeMap","setRadio","repeatRadio"]),Object(i.mapState)("deviceManage",["valueType"]),{setStatus:function(){return function(t){var e=this.data.schedule.weekday;return e&&e.includes(t.key)?"primary":null}}}),created:function(){},mounted:function(){this.init()},methods:{init:function(){this.id?this.getDetail():this.$set(this.data,"type",this.typeMap[t])},onChangeRadioSet:function(t,e){var a=t.target.value;if("time"===e){var n=this.data.schedule.time;this.starttime=1===a?this.$moment():null,this.endtime=null;var i=u({},this.data.schedule,{isrepeat:1===a?0:null,starttime:1===a?n||this.$moment().format(this.GLOBAL.TIME_FORMAT_TIMING):null,endtime:null});this.data=Object.assign({},this.data,{schedule:i})}if("delay"===e){var r=1===a?this.data.delay||1:null;this.data=Object.assign({},this.data,{delay:r})}},onChangeRadio:function(t){var e=t.target.value,a=void 0;a=1===e?"1,2,3,4,5":"";var n=u({},this.data.schedule,{weekday:a});this.data=Object.assign({},this.data,{schedule:n})},setRepeat:function(t){var e=this.data.schedule.weekday,a=void 0===e?"":e,n=a.split(",");if(a.includes(t.key)){if(!(n.length>1))return void this.$message.warning("至少选择一天");var i=n.findIndex(function(e){return e===t.key});n.splice(i,1)}else n.push(t.key);var r=n.findIndex(function(t){return"0"===t});r>-1?(n.splice(r,1),n.sort(),n.push("0")):n.sort();var s=u({},this.data.schedule,{weekday:n.join(",")});this.data=Object.assign({},this.data,{schedule:s})},addDevice:function(t){this.isAction=t;var e=t?"effects":"factors";this.isDeviceModal=!0,this.data[e]=this.data[e]?this.data[e]:[],this.dids=t?this.data[e].map(function(t){return t.deviceid}):[]},handleCancelDevice:function(){this.isDeviceModal=!1},handleOkDevice:function(t){var e=this.isAction?"effects":"factors";this.data[e]=this.data[e]?this.data[e]:[],t.forEach(function(t){t.deviceid=t.did,t.devicename=t.displayname,t.actions=[]}),this.data=Object.assign({},this.data,n({},e,this.data[e].concat(t))),this.handleCancelDevice()},delDevices:function(t,e){this.data[e].splice(t,1)},updateAcion:function(t,e,a){var n=this.data,i=n[a][e];if(i){var r=t.actions;i.actions=r,this.data=n}},cancel:function(){this.$router.back()},showDelModal:function(){var t=this;this.$confirm({title:"确定要删除？",content:"",okText:"确定",cancelText:"取消",onOk:function(){t.del()},onCancel:function(){}})},ok:function(){var e=this;this.form.validateFields(function(a,n){var i=e.id,r=e.data,s=e.typeMap,o=e.GLOBAL,c=e.starttime,l=e.endtime,d=n.name,f=n.operatetime,p=e.data,h=p.type,v=p.schedule,m=p.effects,g=void 0===m?[]:m,b=(p.factors,p.linktasks),y=void 0===b?[]:b;if(v.isrepeat,!a){if(h===s.linkage){if(!e.isValidLinkage())return;e.data.sceneids=y.map(function(t){return t.id})}else{if(g.length<=0)return void e.$message.warning("请设置执行设备!");h===s.normal&&e.formatDevice()}for(var k=0;k<g.length;k+=1){var _=g[k].actions;if((void 0===_?[]:_).length<=0)return void e.$message.warning("请设置设备执行操作!")}var S="timing"===t?f:c;e.data=u({},r,{schedule:u({},v,{starttime:S?e.$moment(S).format(o.TIME_FORMAT_TIMING):"",endtime:l?e.$moment(l).format(o.TIME_FORMAT_TIMING):""}),name:d}),i?e.mod():e.add()}})},formatDevice:function(){var t=this,e=this.data.effects,a=void 0===e?[]:e,n=this.current.actions,i=void 0===n?[]:n;a.forEach(function(e){e.productid=t.productid,e.actions=i})},isValidLinkage:function(){var t=this.starttime,e=this.endtime,a=this.data,n=a.factors,i=void 0===n?[]:n,r=a.effects,s=void 0===r?[]:r,o=a.linktasks,c=void 0===o?[]:o;if(i.length<=0)return this.$message.warning("请设置触发条件!"),!1;if(s.length<=0&&c.length<=0)return this.$message.warning("请设置场景或添加设备!"),!1;for(var u=0;u<i.length;u+=1){var l=i[u].actions,d=void 0===l?[]:l,f=d[0]||{},p=f.attrmethod,h=f.attrvalue;if(null==p||null==h)return this.$message.warning("请设置有效触发条件!"),!1}return!(t&&(!e||e.isBefore(t)))||(this.$message.warning("请选择有效时间范围!"),!1)},add:function(){var e=this;this.$emit("updateSpinning",!0);var a=u({},this.data);l.addTimeLinkage(a).then(function(a){var n=a.errcode;a.data;200===n&&(e.$message.success("操作成功！"),e.$router.push({name:t+"List"}),e.$emit("updateSpinning",!1))}).catch(function(t){e.$emit("updateSpinning",!1)})},mod:function(){var e=this;this.$emit("updateSpinning",!0);var a=u({},this.data);l.modTimeLinkage(a).then(function(a){var n=a.errcode;a.data;200===n&&(e.$message.success("操作成功！"),e.$router.push({name:t+"List"}),e.$emit("updateSpinning",!1))}).catch(function(t){e.$emit("updateSpinning",!1)})},del:function(){var e=this;this.$emit("updateSpinning",!0);var a=this.id;l.delTimeLinkage({id:a}).then(function(a){var n=a.errcode;a.data;200===n&&(e.$message.success("操作成功！"),e.$router.push({name:t+"List"})),e.$emit("updateSpinning",!1)}).catch(function(t){e.$emit("updateSpinning",!1)})}}}}},1021:function(t,e){},1022:function(t,e,a){"use strict";var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("a-modal",{attrs:{"mask-closable":!1,width:560,footer:null,title:"执行操作"},on:{cancel:t.cancel},model:{value:t.isModal,callback:function(e){t.isModal=e},expression:"isModal"}},[a("a-spin",{attrs:{spinning:t.spinning}},[a("a-form",{staticClass:"reset-form-item-10"},[t._l(t.formatAttributes,function(e,n){return[e.valuetype===t.valueType.range?a("a-form-item",{key:""+e.key+n,staticStyle:{"margin-bottom":"0px"},attrs:{"label-col":t.labelCol,"wrapper-col":t.wrapperCol,label:e.text}},[a("a-slider",{attrs:{marks:(i={},i[e.min]=e.min,i[e.max]=e.max,i),max:e.max,min:e.min,step:e.step,"default-value":parseInt(t.deviceStatus[e.key])||e.min},on:{afterChange:function(a){t.setAction(e,a)}}})],1):a("a-form-item",{key:""+e.key+n,attrs:{"label-col":t.labelCol,"wrapper-col":t.wrapperCol,label:e.text}},[a("a-row",{attrs:{gutter:10}},t._l(e.status,function(n){return a("a-col",{key:""+n.value,attrs:{span:6}},[a("a-button",{staticClass:"reset-btn",attrs:{type:t.setStatus(e.key,n.value)},on:{click:function(){t.setAction(e,n.value)}}},[t._v(" "+t._s(n.text)+" ")])],1)}),1)],1)];var i}),t._v(" "),a("div",{staticClass:"modal-footer-btn mt20"},[a("a-button",{on:{click:t.cancel}},[t._v("取消")]),t._v(" "),a("a-button",{staticClass:"ml10",attrs:{type:"primary"},on:{click:t.ok}},[t._v("确定\n          ")])],1)],2)],1)],1)],1)},i=[],r={render:n,staticRenderFns:i};e.a=r},1023:function(t,e,a){"use strict";function n(t){a(1024)}var i=a(1011),r=a(1025),s=a(24),o=n,c=s(i.a,r.a,!1,o,"data-v-41574b64",null);e.a=c.exports},1024:function(t,e){},1025:function(t,e,a){"use strict";var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("a-row",{attrs:{gutter:5}},[a("a-col",{attrs:{span:6}},[a("div",{staticClass:"label-input"},[t._v(t._s(t.getDevicePlaceholder))])]),t._v(" "),a("a-col",{staticStyle:{"text-align":"center"},attrs:{span:1}},[t._v("\n      --\n    ")]),t._v(" "),a("a-col",{attrs:{span:5}},[a("a-button",{attrs:{type:"primary",block:""},on:{click:function(e){return t.setAction()}}},[t._v("设置执行操作")])],1),t._v(" "),a("a-col",{attrs:{span:12}},[a("a-tooltip",{attrs:{placement:"bottomLeft"}},[a("template",{slot:"title"},[a("span",[t._v(t._s(t.getStatusPlaceholder))])]),t._v(" "),a("div",{staticClass:"label-input ellipsis"},[t._v(t._s(t.getStatusPlaceholder))])],2)],1)],1),t._v(" "),t.isStatusModal?a("StatusModal",{attrs:{productid:t.devActions.productid,status:t.status},on:{cancel:t.cancelStatusModal,ok:t.okStatusModal}}):t._e()],1)},i=[],r={render:n,staticRenderFns:i};e.a=r},1026:function(t,e,a){"use strict";function n(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function i(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,a){function n(i,r){try{var s=e[i](r),o=s.value}catch(t){return void a(t)}if(!s.done)return Promise.resolve(o).then(function(t){n("next",t)},function(t){n("throw",t)});t(o)}return n("next")})}}function r(t){if(Array.isArray(t)){for(var e=0,a=Array(t.length);e<t.length;e++)a[e]=t[e];return a}return Array.from(t)}Object.defineProperty(e,"__esModule",{value:!0});var s=a(34),o=a(32),c=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var a=arguments[e];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(t[n]=a[n])}return t},u=o.a.timeLinkageAsk;e.default=function(t){var e;return{data:function(){return{params:{},data:[],pagination:{defaultCurrent:1,current:1,pageSize:this.GLOBAL.PAGE_SIZE_XS,total:0},disabled:!0}},computed:c({},Object(s.mapState)("timeLinkage",["typeMap"]),Object(s.mapGetters)("timeLinkage",["formatRepeat"])),created:function(){this[t+"Fetch"]()},methods:(e={add:function(){this.$router.push({name:t+"Add"})},edit:function(e){this.$router.push({name:t+"Detail",params:{id:e.id}})},onChange:function(t,e){var a=[].concat(r(this.data)),n=a.filter(function(t){return t.id===e.id})[0];n&&(n.enable=t,this.data=a);var i=c({},e,{enable:t?1:0});this.mod(i)},mod:function(t){var e=this;this.$emit("updateSpinning",!0),u.modTimeLinkage(t).then(function(a){var n=a.errcode;a.data;200===n?(e.$message.success("操作成功！"),e.$emit("updateSpinning",!1)):e.reset(t)}).catch(function(a){e.$emit("updateSpinning",!1),e.reset(t)})},reset:function(t){var e=[].concat(r(this.data)),a=t.id,n=t.enable,i=e.filter(function(t){return t.id===a})[0];i&&(i.enable=1!==n),this.data=e},change:function(e,a){var n=this.pagination;n.current=e,n.pageSize=a,this[t+"Fetch"]()}},n(e,t+"Fetch",function e(){var a=this;return i(regeneratorRuntime.mark(function n(){var i,r,s,o,u,l,d;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return i=a,a.$emit("updateSpinning",!0),r=i.pagination,s=c({offset:r.current,limit:r.pageSize},i.params||{}),n.next=6,a[t+"FetchList"](s);case 6:o=n.sent,o&&(u=o.data,l=u===e?[]:u,d=o.total,i.data=l||[],r.total=d||0,a.$emit("updateSpinning",!1));case 8:case"end":return n.stop()}},n,a)}))()}),n(e,t+"FetchList",function e(){var a=this;return i(regeneratorRuntime.mark(function n(){var i,r,s,o,c,l,d,f;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return i=a.typeMap,r=a.pagination,s=r.current,o=r.pageSize,c={limit:o,offset:s,order:"createtime",seq:-1,type:i[""+t]},n.next=5,u.getTimeLinkageList(c);case 5:return l=n.sent,l.errcode,d=l.data,f=d===e?{}:d,a.formatData(f),n.abrupt("return",{total:f.totalsize,data:f.alist});case 11:case"end":return n.stop()}},n,a)}))()}),n(e,"formatData",function(e){var a=this,n=e.alist,i=void 0===n?[]:n;switch(t){case"timing":i&&i.forEach(function(t){var e=t.weekday;t.enable=1===t.enable,t.weekday=a.formatRepeat(e)});break;case"scene":i&&i.forEach(function(t){t.execute=!1})}}),e)}}},1276:function(t,e,a){"use strict";function n(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,a){function n(i,r){try{var s=e[i](r),o=s.value}catch(t){return void a(t)}if(!s.done)return Promise.resolve(o).then(function(t){n("next",t)},function(t){n("throw",t)});t(o)}return n("next")})}}var i=(a(34),a(32)),r=a(1016),s=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var a=arguments[e];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(t[n]=a[n])}return t},o=r.a.TimeLinkageDetailCreaterMix,c=i.a.timeLinkageAsk;e.a={name:"TimingDetail",components:{},mixins:[o("timing")],props:{},data:function(){return{type:"",productid:"",productList:[]}},computed:{getPlaceholder:function(){var t=this.current.actions,e=void 0===t?[]:t,a=e.map(function(t){return t.attrname});return 0===e.length?this.empty:a.join("/")}},watch:{},created:function(){var t=this;return n(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getProduct();case 2:t.initData();case 3:case"end":return e.stop()}},e,t)}))()},mounted:function(){},methods:{initData:function(){var t=this.id,e=this.typeMap;t||this.selectType(e.normal)},selectType:function(t){var e=this;return n(regeneratorRuntime.mark(function a(){var n;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(t!==e.typeMap.define){a.next=5;break}e.productid=null,e.current={},a.next=7;break;case 5:return a.next=7,e.getProduct();case 7:n=s({},e.data,{type:t,effects:[]}),e.data=Object.assign({},e.data,n);case 9:case"end":return a.stop()}},a,e)}))()},handleChange:function(){this.current={},this.data=Object.assign({},this.data,{effects:[]})},setAction:function(){var t=this;this.productid?this.isStatusModal=!0:this.$message.warning("请先选择执行类型");var e=this.current.actions,a=void 0===e?[]:e,n={};a.forEach(function(e){n[e.attrmethod]=e.valuetype===t.valueType.range?parseInt(e.attrvalue):e.attrvalue}),this.status=n},cancelStatusModal:function(){this.isStatusModal=!1},okStatusModal:function(t){var e=t.map(function(t){return{attrmethod:t.key,attrname:t.text,attrvalue:""+t.value}});this.current=Object.assign({},this.current,{actions:e}),this.cancelStatusModal()},validatorAction:function(t,e,a){var n=this.current.actions;(void 0===n?[]:n).length<=0?a("请设置执行操作"):a()},getDetail:function(){var t=this;return n(regeneratorRuntime.mark(function e(){var a,n,i,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.$emit("updateSpinning",!0),a=t.id,n=t.typeMap,i=t.GLOBAL,r={id:a},e.next=5,c.getTimeLinkageInfo(r).then(function(e){var a=e.errcode,r=e.data,o=void 0===r?{}:r;if(200===a){var c=o.schedule,u=void 0===c?{}:c,l=o.effects,d=void 0===l?[]:l,f=o.type;o.schedule=s({},u,{starttime:u.starttime?t.$moment(u.starttime,i.TIME_FORMAT_TIMING):null}),t.data=o,t.current=d[0]||{},t.productid=f===n.normal?d[0].productid:null}t.$emit("updateSpinning",!1)}).catch(function(e){t.$emit("updateSpinning",!1)});case 5:case"end":return e.stop()}},e,t)}))()},getProduct:function(){var t=this;return n(regeneratorRuntime.mark(function e(){var a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a={offset:1,limit:t.GLOBAL.MAX_LEN},e.next=3,c.getProduct(a).then(function(e){var a=e.errcode,n=e.data,i=void 0===n?{}:n;if(200===a){var r=i.productsinfo,s=void 0===r?[]:r;t.productList=s,t.productid=s[0].id}t.$emit("updateSpinning",!1)}).catch(function(e){t.$emit("updateSpinning",!1)});case 3:case"end":return e.stop()}},e,t)}))()}}}},1703:function(t,e){},1704:function(t,e,a){"use strict";var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[t.id?t._e():a("div",[a("div",{staticClass:"tips"},[t._v("\n      选择要添加定时的种类\n    ")]),t._v(" "),a("div",{staticClass:"btn-panel mtb20"},[a("div",{staticClass:"btn mr10",class:{hover:t.data.type===t.typeMap.normal},on:{click:function(e){return t.selectType(t.typeMap.normal)}}},[a("div",{staticClass:"title"},[t._v("普通定时")]),t._v(" "),a("div",{staticClass:"tips"},[t._v("多个设备(相同类型)执行一个操作")])]),t._v(" "),a("div",{staticClass:"btn",class:{hover:t.data.type===t.typeMap.define},on:{click:function(e){return t.selectType(t.typeMap.define)}}},[a("div",{staticClass:"title"},[t._v("自定义定时")]),t._v(" "),a("div",{staticClass:"tips"},[t._v("多个设备执行多个操作")])])])]),t._v(" "),a("a-form",{staticClass:"reset-line-height",staticStyle:{width:"800px"},attrs:{form:t.form,"hide-required-mark":""}},[a("a-form-item",{attrs:{"label-col":t.labelCol,"wrapper-col":t.wrapperCol,colon:!1,label:"定时名称"}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["name",{initialValue:t.data.name,rules:[{required:!0,message:"输入定时名称长度不超过20个字符",max:t.GLOBAL.NAME_MAX_LEN}]}],expression:"[ `name`,{\n        initialValue:data.name,\n        rules: [{ required: true, message: '输入定时名称长度不超过20个字符' ,max:GLOBAL.NAME_MAX_LEN}],} ]"}]})],1),t._v(" "),a("a-form-item",{attrs:{"label-col":t.labelCol,"wrapper-col":t.wrapperCol,colon:!1,label:"执行时间"}},[a("a-time-picker",{directives:[{name:"decorator",rawName:"v-decorator",value:["operatetime",{initialValue:t.data.schedule.starttime,rules:[{required:!0,message:"请选择执行时间"}]}],expression:"[ `operatetime`,{\n        initialValue:data.schedule.starttime,\n        rules: [{ required: true, message: '请选择执行时间'}],} ]"}],staticStyle:{width:"100%"},attrs:{format:t.GLOBAL.TIME_FORMAT_TIMING}})],1),t._v(" "),a("a-form-item",{attrs:{"label-col":t.labelCol,"wrapper-col":{span:22},colon:!1,label:"重复设置"}},[a("a-radio-group",{attrs:{options:t.repeatRadio},on:{change:t.onChangeRadio},model:{value:t.data.schedule.isrepeat,callback:function(e){t.$set(t.data.schedule,"isrepeat",e)},expression:"data.schedule.isrepeat"}}),t._v(" "),1===t.data.schedule.isrepeat?t._l(t.repeat,function(e){return a("a-button",{key:e.key,staticClass:"mr10",attrs:{type:t.setStatus(e)},on:{click:function(a){return t.setRepeat(e)}}},[t._v(t._s(e.text))])}):t._e()],2),t._v(" "),t.data.type===t.typeMap.normal?a("a-form-item",{attrs:{"label-col":t.labelCol,"wrapper-col":{span:12},colon:!1,label:"执行操作"}},[a("a-row",{attrs:{gutter:10}},[a("a-col",{attrs:{span:16}},[a("a-select",{staticStyle:{width:"100%"},on:{change:t.handleChange},model:{value:t.productid,callback:function(e){t.productid=e},expression:"productid"}},t._l(t.productList,function(e){return a("a-select-option",{key:e.pid,attrs:{value:e.pid}},[t._v(t._s(e.productname))])}),1)],1),t._v(" "),a("a-col",{attrs:{span:8}},[a("a-button",{attrs:{type:"primary",block:""},on:{click:function(e){return t.setAction()}}},[t._v("设置执行操作")])],1)],1),t._v(" "),a("a-tooltip",{attrs:{placement:"bottomLeft"}},[a("template",{slot:"title"},[a("span",[t._v(t._s(t.getPlaceholder))])]),t._v(" "),a("div",{staticClass:"label-input ellipsis mt10"},[t._v(t._s(t.getPlaceholder))])],2)],1):t._e(),t._v(" "),a("a-form-item",{attrs:{"label-col":t.labelCol,"wrapper-col":{span:21},colon:!1,label:"执行设备"}},[a("a-button",{staticClass:"mr10",on:{click:function(e){return t.addDevice(!0)}}},[t._v("添加设备")]),t._v(" "),a("span",{staticClass:"actived-text"},[t._v(" 执行设备"+t._s(t.data.effects&&t.data.effects.length||0)+"台")]),t._v(" "),a("br"),t._v(" "),t.data.effects&&t.data.effects.length>0?a("div",{staticClass:"tag-box mt10"},t._l(t.data.effects,function(e,n){return a("div",{key:e.deviceid,staticClass:"tag"},[a("a-row",[t.data.type===t.typeMap.normal?[a("a-col",{attrs:{span:22}},[t._v("\n                "+t._s(e.devicename+"-("+e.deviceid+")")+"\n              ")])]:[a("a-col",{attrs:{span:22}},[a("Actions",{staticClass:"tag",attrs:{actions:e},on:{getValue:function(e){t.updateAcion(e,n,"effects")}}})],1)],t._v(" "),a("a-col",[a("a-icon",{staticClass:"extra-icon cursor error",class:{"input-icon":t.data.type!==t.typeMap.normal},attrs:{type:"close-circle"},on:{click:function(e){return t.delDevices(n,"effects")}}})],1)],2)],1)}),0):t._e()],1),t._v(" "),a("a-form-item",{staticStyle:{"margin-top":"100px"},attrs:{"label-col":{span:0},"wrapper-col":{span:24},colon:!1,label:""}},[a("a-button",{staticClass:"mr10",on:{click:t.cancel}},[t._v("取消")]),t._v(" "),t.id?a("a-button",{staticClass:"mr10",attrs:{type:"danger"},on:{click:t.showDelModal}},[t._v("删除")]):t._e(),t._v(" "),a("a-button",{staticClass:"mr10",attrs:{type:"primary"},on:{click:t.ok}},[t._v("确定\n      ")])],1)],1),t._v(" "),t.isDeviceModal?a("DeviceModal",{attrs:{data:t.dids,productid:t.productid,title:"添加设备",flag:"timeLinkage"},on:{cancel:t.handleCancelDevice,ok:t.handleOkDevice}}):t._e(),t._v(" "),t.isStatusModal?a("StatusModal",{attrs:{productid:t.productid,status:t.status},on:{cancel:t.cancelStatusModal,ok:t.okStatusModal}}):t._e()],1)},i=[],r={render:n,staticRenderFns:i};e.a=r},992:function(t,e,a){"use strict";function n(t){a(1703)}Object.defineProperty(e,"__esModule",{value:!0});var i=a(1276),r=a(1704),s=a(24),o=n,c=s(i.a,r.a,!1,o,"data-v-6d7481c8",null);e.default=c.exports}});